<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{title}}</title>
  <script>
  // This script helps ensure clickable links work in the PDF
  document.addEventListener('DOMContentLoaded', function() {
    // Make sure all links open in a new tab and have the appropriate styling
    const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.href && !link.getAttribute('target')) {
        // If it's an anchor link (internal navigation), don't set target="_blank"
        if (link.href.includes('#')) {
          // It's an internal link - enhance for PDF navigation
          const href = link.getAttribute('href');
          if (href.startsWith('#')) {
            const targetId = href.substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
              // Add special attributes for PDF navigation
              link.setAttribute('data-internal-link', 'true');
              link.setAttribute('data-target', targetId);
            }
          }
        } else {
          // External link - open in new tab
          link.setAttribute('target', '_blank');
        }
      }
    });
  });
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Merriweather:wght@400;700&display=swap');
    
    body {
      font-family: 'Roboto', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 0;
      background-color: #fff;
      font-size: 12px;
    }
    
    .container {
      max-width: 100%;
      padding: 10px;
    }
    
    /* Cover page styles */
    .cover-page {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 95vh; /* Reduced height to ensure it fits on one page */
      padding: 20px; /* Reduced padding */
      page-break-after: always;
      background-color: #308c66; /* Updated green color */
    }
    
    .cover-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 40px; /* Increased to accommodate larger logos */
      width: 100%;
    }
    
    .logo {
      height: 225px; /* Increased by another 50% from 150px */
      max-width: 900px; /* Increased by another 50% from 600px */
      object-fit: contain;
    }
    
    .logo-placeholder {
      height: 225px; /* Increased by another 50% from 150px */
      width: 675px; /* Increased by another 50% from 450px */
      background-color: #008866;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 48px; /* Increased from 32px */
      border-radius: 5px;
    }
    
    .cover-content {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      flex-grow: 1;
      text-align: center;
    }
    
    .cover-title {
      font-family: 'Merriweather', serif;
      font-size: 32px;
      font-weight: 700;
      color: #ffffff; /* Changed to white */
      margin-bottom: 20px;
      text-align: center;
    }
    
    .cover-subtitle {
      font-size: 20px;
      color: #e6f5f0; /* Light green */
      margin-bottom: 10px;
      text-align: center;
    }
    
    .cover-date {
      font-size: 16px;
      color: #e6f5f0; /* Light green */
      margin-top: 30px;
      text-align: center;
    }
    
    .cover-footer {
      font-size: 11px;
      color: #e6f5f0; /* Light green */
      text-align: center;
      margin-top: 20px; /* Reduced margin */
    }
    
    /* Added styles for the country/crisis placeholder */
    .cover-country {
      font-size: 18px;
      color: #ffffff;
      margin-bottom: 5px;
      text-align: center;
      font-weight: 300;
    }
    
    /* Added styles for the date range placeholder */
    .cover-date-range {
      font-size: 14px;
      color: #e6f5f0;
      margin-top: 5px;
      text-align: center;
      font-style: italic;
    }
    
    /* Original styles */
    .report-title {
      text-align: center;
      color: #00664d;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 20px;
      border-bottom: 2px solid #00664d;
      padding-bottom: 10px;
      font-family: 'Merriweather', serif;
    }
    
    .toc-container {
      margin: 20px 0 40px;
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      page-break-after: always;
    }
    
    .toc-title {
      font-size: 18px;
      font-weight: 700;
      color: #00664d;
      margin-bottom: 15px;
      border-bottom: 1px solid #00664d;
      padding-bottom: 5px;
      font-family: 'Merriweather', serif;
    }
    
    .toc-group {
      margin-bottom: 15px;
    }
    
    .toc-main-category {
      margin-bottom: 20px;
    }
    
    .toc-main-category-title {
      font-size: 18px;
      font-weight: 600;
      color: #00664d;
      margin: 20px 0 10px 0;
      border-bottom: 1px solid #00664d;
      padding-bottom: 5px;
      font-family: 'Merriweather', serif;
    }
    
    .toc-group-title {
      font-size: 16px;
      font-weight: 500;
      color: #008866;
      margin-bottom: 10px;
      margin-left: 15px;
    }
    
    .toc-sections {
      margin-left: 30px;
    }
    
    .toc-section {
      margin-bottom: 5px;
    }
    
    .toc-section a {
      color: #333;
      text-decoration: none;
      font-size: 14px;
      position: relative;
      padding-left: 5px;
      border-left: 2px solid transparent;
      transition: all 0.2s ease;
    }
    
    .toc-section a:hover {
      text-decoration: underline;
      color: #008866;
      border-left: 2px solid #008866;
      padding-left: 8px;
    }
    
    .toc-page {
      float: right;
    }
    
    .group {
      margin-bottom: 30px;
    }
    
    .first-group {
      page-break-before: avoid;
    }
    
    .category-section {
      margin-bottom: 40px;
    }
    
    .main-category-title {
      color: #00664d;
      font-size: 24px;
      font-weight: 700;
      margin: 0; /* Remove default margins */
      text-align: center;
      border-bottom: 2px solid #00664d;
      padding-bottom: 8px;
      font-family: 'Merriweather', serif;
    }
    
    .group-title {
      color: #00664d;
      font-size: 20px;
      font-weight: 500;
      margin-bottom: 15px;
      border-bottom: 1px solid #00664d;
      padding-bottom: 5px;
      font-family: 'Merriweather', serif;
    }
    
    .group-content-empty {
      margin-bottom: 30px;
    }
    
    .section {
      margin-bottom: 20px;
    }
    
    h2 {
      color: #008866;
      font-size: 18px;
      font-weight: 500;
      margin-top: 20px;
      margin-bottom: 10px;
      font-family: 'Merriweather', serif;
    }
    
    p {
      margin-bottom: 15px;
      text-align: justify;
    }
    
    .sources-section {
      margin-top: 20px;
      border-top: 1px dashed #ccc;
      padding-top: 10px;
    }
    
    .sources-title {
      font-size: 16px;
      font-weight: 500;
      color: #666;
      margin-bottom: 10px;
      font-family: 'Merriweather', serif;
    }
    
    .source-list {
      list-style-type: none;
      padding-left: 0;
    }
    
    .source-item {
      margin-bottom: 5px;
      font-size: 11px;
      color: #666;
    }
    
    .source-url {
      display: block;
      margin-top: 2px;
      margin-left: 10px;
      font-size: 10px;
      max-width: 90%;
      overflow-wrap: break-word;
      word-wrap: break-word;
    }
    
    .source-url a {
      color: #008866;
      text-decoration: none;
      font-weight: normal;
    }
    
    .source-url a:hover {
      text-decoration: underline;
    }
    
    .consolidated-sources {
      margin-top: 40px;
      page-break-before: always;
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 5px;
    }
    
    .sources-by-group {
      margin-bottom: 15px;
    }
    
    .source-group-title {
      font-size: 14px;
      font-weight: 500;
      color: #008866;
      margin-bottom: 5px;
      border-bottom: 1px solid #dddddd;
      padding-bottom: 3px;
    }
    
    .page-break {
      page-break-after: always;
    }
    
    /* Content styling */
    .content-block {
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      border-left: 3px solid #008866;
    }
    
    /* Styling for content */
    .content-block h2 {
      color: #008866;
      font-size: 18px;
      font-weight: 500;
      margin-top: 20px;
      margin-bottom: 10px;
      font-family: 'Merriweather', serif;
    }
    
    .content-block p {
      margin-bottom: 15px;
      text-align: justify;
    }
    
    .content-block ul, .content-block ol {
      margin-bottom: 15px;
      padding-left: 20px;
    }
    
    .content-block li {
      margin-bottom: 5px;
    }
    
    /* Markdown formatting */
    .markdown h1, .markdown h2, .markdown h3, .markdown h4, .markdown h5, .markdown h6 {
      color: #008866;
      font-family: 'Merriweather', serif;
      margin-top: 1em;
      margin-bottom: 0.5em;
    }
    
    .markdown h1 {
      font-size: 22px;
    }
    
    .markdown h2 {
      font-size: 18px;
    }
    
    .markdown h3 {
      font-size: 16px;
    }
    
    .markdown p {
      margin-bottom: 1em;
    }
    
    .markdown ul, .markdown ol {
      margin-bottom: 1em;
      padding-left: 20px;
    }
    
    .markdown li {
      margin-bottom: 0.5em;
    }
    
    .markdown code {
      background-color: #f0f0f0;
      padding: 2px 4px;
      border-radius: 3px;
      font-family: monospace;
    }
    
    .markdown blockquote {
      border-left: 3px solid #ccc;
      padding-left: 10px;
      margin-left: 0;
      color: #666;
    }
    
    /* Better styling for document header/footer */
    @page {
      margin: 25mm 20mm;
    }
    
    /* PDF-specific link styling */
    @media print {
      a {
        color: #008866 !important;
        text-decoration: underline !important;
      }
      
      .source-url a {
        color: #008866 !important;
        text-decoration: underline !important;
        word-break: break-all;
      }
      
      .toc-section a {
        color: #00664d !important;
        text-decoration: none !important;
      }
    }
    
    .sources-category {
      margin-bottom: 30px;
    }
    
    .source-category-title {
      font-size: 20px;
      font-weight: 600;
      color: #00664d;
      margin: 25px 0 15px 0;
      border-bottom: 1px solid #00664d;
      padding-bottom: 5px;
      font-family: 'Merriweather', serif;
    }
    
    .source-group-title {
      font-size: 16px;
      font-weight: 500;
      color: #008866;
      margin: 15px 0 10px 0;
      border-bottom: 1px solid #dddddd;
      padding-bottom: 3px;
    }
    
    /* Partner logo as white */
    .partner-logo {
      height: 225px;
      max-width: 900px;
      object-fit: contain;
      filter: brightness(0) invert(1); /* Makes the logo white */
    }
    
    /* Container for main category title to center it vertically */
    .main-category-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 20vh; /* Reduced significantly to avoid blank pages */
      padding: 2% 0; /* Reduced padding */
      margin-top: 40px; /* Add top margin instead of page break */
      margin-bottom: 20px; /* Add bottom margin */
    }
    
    /* About page styles */
    .about-page {
      display: flex;
      flex-direction: column;
      padding: 40px;
      page-break-after: always;
    }
    
    .about-title {
      font-size: 24px;
      font-weight: 700;
      color: #00664d;
      margin-bottom: 20px;
      border-bottom: 2px solid #00664d;
      padding-bottom: 8px;
      font-family: 'Merriweather', serif;
    }
    
    .about-section {
      margin-bottom: 30px;
    }
    
    .about-subtitle {
      font-size: 18px;
      font-weight: 600;
      color: #008866;
      margin-bottom: 10px;
      font-family: 'Merriweather', serif;
    }
    
    .about-content {
      font-size: 12px;
      color: #333;
      line-height: 1.6;
    }
    
    /* Specific style for second main category to add page break */
    .second-main-category {
      page-break-before: always;
    }
  </style>
</head>
<body>
  <!-- Cover Page -->
  <div class="cover-page">
    <div class="cover-header">
      {{#if gannetLogoBase64}}
      <img src="{{gannetLogoBase64}}" alt="GANNET Logo" class="logo">
      {{else}}
      <div class="logo-placeholder">GANNET</div>
      {{/if}}
      
      {{#if partnerLogoBase64}}
      <img src="{{partnerLogoBase64}}" alt="Partner Logo" class="partner-logo">
      {{else}}
      <div class="logo-placeholder">Partner</div>
      {{/if}}
    </div>
    
    <div class="cover-content">
      <p class="cover-country">[Country/Crisis]</p>
      <h1 class="cover-title">{{title}}</h1>
      <p class="cover-subtitle">Weekly Situation Report</p>
      <p class="cover-date-range">[From: DD/MM/YYYY to DD/MM/YYYY]</p>
      <p class="cover-date">Generated on {{formatDate}}</p>
    </div>
    
    <div class="cover-footer">
      <p>GANNET SitHub &copy; {{currentYear}}</p>
    </div>
  </div>
  
  <!-- About Page -->
  <div class="about-page">
    <h1 class="about-title">About this Report</h1>
    
    <div class="about-section">
      <h2 class="about-subtitle">Purpose</h2>
      <p class="about-content">
        This report provides a comprehensive overview of the current humanitarian situation, 
        focusing on both operational environment factors and sectoral analysis. It aims to 
        support informed decision-making for humanitarian partners and stakeholders.
      </p>
    </div>
    
    <div class="about-section">
      <h2 class="about-subtitle">Methodology</h2>
      <p class="about-content">
        This report aims to provide reliable and up-to-date information on the context of the situation at hand. To ensure accuracy and relevance, DFS has conducted a rigorous Secondary Data Review (SDR) process, focusing on publicly available data related to the humanitarian context. DFS Analysts leveraged the AI-based tool GANNET to support and accelerate the analysis process; however, all findings presented have been directly developed and verified by the analysis team. Recognizing the potential for bias or inaccuracies in media and other secondary sources, special care has been taken to triangulate and validate all information, with direct links to original sources provided for transparency and further review. In response to requests from partners, DFS rapidly launched the Emergency SituationHub, offering a comprehensive and continually updated background overview. Our interactive media tool supports users in navigating relevant local and international sources, while GANNET has enabled contributions to joint analytical products and inter-agency processes, including workshops, SOPs, workplans, and terms of reference.
      </p>
    </div>
    
    <div class="about-section">
      <h2 class="about-subtitle">About GANNET</h2>
      <p class="about-content">
        GANNET is a humanitarian information management system designed to support 
        coordination and response planning. It provides tools for data collation, 
        analysis, and visualization to help humanitarian actors access and utilize 
        critical information for their operations. GANNET is committed to improving 
        the effectiveness of humanitarian action through better information management.
      </p>
    </div>
  </div>

  <div class="container">
    <h1 class="report-title">{{title}}</h1>
    
    <!-- Table of Contents -->
    <div class="toc-container">
      <h2 class="toc-title">Table of Contents</h2>
      
      <!-- Operational Environment Section -->
      <div class="toc-main-category">
        <div class="toc-main-category-title">{{operationalEnvCategory.title}}</div>
        
        <!-- Groups under Operational Environment -->
        {{#each operationalEnvCategory.groups}}
        <div class="toc-group">
          <div class="toc-group-title">{{this.title}}</div>
          {{#if this.headings.length}}
          <div class="toc-sections">
            {{#each this.headings}}
            <div class="toc-section">
              <a href="#{{this.id}}" class="internal-link" data-target-id="{{this.id}}">{{this.title}}</a>
            </div>
            {{/each}}
          </div>
          {{/if}}
        </div>
        {{/each}}
      </div>
      
      <!-- Sectoral Analysis Section -->
      <div class="toc-main-category">
        <div class="toc-main-category-title">{{sectoralAnalysisCategory.title}}</div>
        
        <!-- Groups under Sectoral Analysis -->
        {{#each sectoralAnalysisCategory.groups}}
        <div class="toc-group">
          <div class="toc-group-title">{{this.title}}</div>
          {{#if this.headings.length}}
          <div class="toc-sections">
            {{#each this.headings}}
            <div class="toc-section">
              <a href="#{{this.id}}" class="internal-link" data-target-id="{{this.id}}">{{this.title}}</a>
            </div>
            {{/each}}
          </div>
          {{/if}}
        </div>
        {{/each}}
      </div>
      
      {{#if hasConsolidatedSources}}
      <div class="toc-group">
        <div class="toc-group-title">Sources</div>
      </div>
      {{/if}}
    </div>
    
    <!-- Content -->
    <!-- Operational Environment Section -->
    <div class="category-section">
      <div class="main-category-container">
        <h1 class="main-category-title">{{operationalEnvCategory.title}}</h1>
      </div>
      
      {{#each operationalEnvCategory.groups}}
      <div class="group">
        <h2 class="group-title">{{this.title}}</h2>
        
        {{#if this.content}}
        <div class="content-block markdown">
          {{{this.content}}}
          
          {{#if this.sections}}
            {{#each this.sections}}
            <div class="section">
              <h2 id="{{this.id}}">{{this.title}}</h2>
              <div class="markdown">{{{this.content}}}</div>
            </div>
            {{/each}}
          {{/if}}
        </div>
        {{else if this.sections.length}}
        <div class="content-block markdown">
          {{#each this.sections}}
          <div class="section">
            <h2 id="{{this.id}}">{{this.title}}</h2>
            <div class="markdown">{{{this.content}}}</div>
          </div>
          {{/each}}
        </div>
        {{else}}
        <!-- Empty group, it's just a title -->
        <div class="group-content-empty"></div>
        {{/if}}
      </div>
      {{/each}}
    </div>
    
    <!-- Sectoral Analysis Section -->
    <div class="category-section second-main-category">
      <div class="main-category-container">
        <h1 class="main-category-title">{{sectoralAnalysisCategory.title}}</h1>
      </div>
      
      {{#each sectoralAnalysisCategory.groups}}
      <div class="group">
        <h2 class="group-title">{{this.title}}</h2>
        
        {{#if this.content}}
        <div class="content-block markdown">
          {{{this.content}}}
          
          {{#if this.sections}}
            {{#each this.sections}}
            <div class="section">
              <h2 id="{{this.id}}">{{this.title}}</h2>
              <div class="markdown">{{{this.content}}}</div>
            </div>
            {{/each}}
          {{/if}}
        </div>
        {{else if this.sections.length}}
        <div class="content-block markdown">
          {{#each this.sections}}
          <div class="section">
            <h2 id="{{this.id}}">{{this.title}}</h2>
            <div class="markdown">{{{this.content}}}</div>
          </div>
          {{/each}}
        </div>
        {{else}}
        <!-- Empty group, it's just a title -->
        <div class="group-content-empty"></div>
        {{/if}}
      </div>
      {{/each}}
    </div>
    
    <!-- Consolidated Sources Section -->
    {{#if hasConsolidatedSources}}
    <div class="consolidated-sources">
      <h2 class="sources-title">Sources</h2>
      
      <!-- Operational Environment Sources -->
      <div class="sources-category">
        <h3 class="source-category-title">{{operationalEnvCategory.title}}</h3>
        
        {{#each operationalEnvCategory.groups}}
          {{#with this}}
          <!-- Filter sources for this group -->
          <div class="sources-by-group">
            <h4 class="source-group-title">{{this.title}}</h4>
            <ul class="source-list">
              {{#each @root.consolidatedSources}}
                {{#if (eq this.group ../title)}}
                {{#if (eq this.category ../../operationalEnvCategory.title)}}
                <li class="source-item">
                  <strong>{{this.title}}</strong>
                  {{#if this.section}} 
                  <span class="source-section">({{this.section}})</span>
                  {{/if}}
                  {{#if this.url}}
                  <div class="source-url">
                    <a href="{{this.url}}" target="_blank">{{this.url}}</a>
                  </div>
                  {{/if}}
                </li>
                {{/if}}
                {{/if}}
              {{/each}}
            </ul>
          </div>
          {{/with}}
        {{/each}}
      </div>
      
      <!-- Sectoral Analysis Sources -->
      <div class="sources-category">
        <h3 class="source-category-title">{{sectoralAnalysisCategory.title}}</h3>
        
        {{#each sectoralAnalysisCategory.groups}}
          {{#with this}}
          <!-- Filter sources for this group -->
          <div class="sources-by-group">
            <h4 class="source-group-title">{{this.title}}</h4>
            <ul class="source-list">
              {{#each @root.consolidatedSources}}
                {{#if (eq this.group ../title)}}
                {{#if (eq this.category ../../sectoralAnalysisCategory.title)}}
                <li class="source-item">
                  <strong>{{this.title}}</strong>
                  {{#if this.section}} 
                  <span class="source-section">({{this.section}})</span>
                  {{/if}}
                  {{#if this.url}}
                  <div class="source-url">
                    <a href="{{this.url}}" target="_blank">{{this.url}}</a>
                  </div>
                  {{/if}}
                </li>
                {{/if}}
                {{/if}}
              {{/each}}
            </ul>
          </div>
          {{/with}}
        {{/each}}
      </div>
    </div>
    {{/if}}
  </div>
</body>
</html>
